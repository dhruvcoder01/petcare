<div class="dashboard-container" [class.no-scroll]="showAddModal">
ย <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
ย ย <div class="logo">
ย ย ย <span class="logo-icon">๐พ</span>
ย ย ย @if (!sidebarCollapsed) { 
ย ย ย ย <span class="logo-text">PetCare</span>
ย ย ย }
ย ย </div>
 <app-chatbot></app-chatbot>

ย ย <nav class="menu">
ย ย ย <div 
ย ย ย ย class="menu-item" 
ย ย ย ย [class.active]="activeSection === 'dashboard'" 
ย ย ย ย (click)="navigateTo('dashboard')"
ย ย ย ย data-tooltip="Dashboard">
ย ย ย ย <span class="menu-icon">๐</span>
ย ย ย ย @if (!sidebarCollapsed) {
ย ย ย ย ย <span class="menu-text">Dashboard</span>
ย ย ย ย }
ย ย ย </div>
      
ย ย ย <div 
ย ย ย ย class="menu-item" 
ย ย ย ย [class.active]="activeSection === 'shop'" 
ย ย ย ย (click)="navigateTo('shop')"
ย ย ย ย data-tooltip="Shop">
ย ย ย ย <span class="menu-icon">๐</span>
ย ย ย ย @if (!sidebarCollapsed) {
ย ย ย ย ย <span class="menu-text">Shop</span>
ย ย ย ย }
ย ย ย </div>
ย ย ย <div 
ย ย ย ย class="menu-item" 
ย ย ย ย [class.active]="activeSection === 'vaccines'" 
ย ย ย ย (click)="navigateTo('vaccines')"
ย ย ย ย data-tooltip="Vaccines">
ย ย ย ย <span class="menu-icon">๐</span>
ย ย ย ย @if (!sidebarCollapsed) {
ย ย ย ย ย <span class="menu-text">Vaccines</span>
ย ย ย ย }
ย ย ย </div>
ย ย ย <div 
ย ย ย ย class="menu-item" 
ย ย ย ย [class.active]="activeSection === 'vets'" 
ย ย ย ย (click)="navigateTo('vets')"
ย ย ย ย data-tooltip="Vets">
ย ย ย ย <span class="menu-icon">๐งโโ๏ธ</span>
ย ย ย ย @if (!sidebarCollapsed) {
ย ย ย ย ย <span class="menu-text">Vets</span>
ย ย ย ย }
ย ย ย </div>
ย ย ย <div 
ย ย ย ย class="menu-item" 
ย ย ย ย [class.active]="activeSection === 'profile'" 
ย ย ย ย (click)="navigateTo('profile')"
ย ย ย ย data-tooltip="Profile">
ย ย ย ย <span class="menu-icon">๐ค</span>
ย ย ย ย @if (!sidebarCollapsed) {
ย ย ย ย ย <span class="menu-text">Profile</span>
ย ย ย ย }
ย ย ย </div>
ย ย ย <div class="menu-item logout" 
ย ย ย ย [class.active]="activeSection === 'logout'" 
ย ย ย ย (click)="navigateTo('logout')" 
ย ย ย ย data-tooltip="Logout">
ย ย ย ย <span class="menu-icon">๐ช</span>
ย ย ย ย @if (!sidebarCollapsed) {
ย ย ย ย ย <span class="menu-text">Logout</span>
ย ย ย ย }
ย ย ย </div>
ย ย </nav>

ย ย <button class="toggle-btn" (click)="toggleSidebar()">
ย ย ย {{ sidebarCollapsed ? 'โ' : 'โ' }}
ย ย </button>
ย </aside>

ย <main class="main-content">
ย ย <div class="vaccine-page-container">
ย ย ย <header class="page-header">
ย ย ย ย <h1>Vaccination & Health Tracker</h1>
ย ย ย ย <p>Manage records, view history, and track upcoming doses for your pets.</p>
ย ย ย </header>

ย ย ย <div class="action-bar">
ย ย ย ย <div class="pet-selector-group">
ย ย ย ย ย ย <label for="pet-select">Viewing Records for:</label>
ย ย ย ย ย ย <select id="pet-select" #petSelect (change)="selectPet(petSelect.value)">
ย ย ย ย ย ย ย @if (pets.length === 0) { 
ย ย ย ย ย ย ย ย <option value="" disabled>No Pets Found</option>
ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย @for (pet of pets; track pet.id) { 
ย ย ย ย ย ย ย ย <option [value]="pet.id" [selected]="pet.id === selectedPet?.id">
ย ย ย ย ย ย ย ย ย {{ pet.name }} ({{ pet.type }})
ย ย ย ย ย ย ย ย </option>
ย ย ย ย ย ย ย }
ย ย ย ย ย ย </select>
ย ย ย ย </div>
ย ย ย ย 
ย ย ย ย <button class="add-record-btn" (click)="openAddRecordModal()" [disabled]="!selectedPet">
ย ย ย ย ย ย <span class="plus-icon">โ</span> Log New Dose
ย ย ย ย </button>
ย ย ย ย 
ย ย ย ย <button class="find-vet-btn" (click)="navigateTo('vets')">
ย ย ย ย ย ย <span class="vet-icon">๐ฉบ</span> Find Vaccine Center
ย ย ย ย </button>
ย ย ย </div>

ย ย ย @if (selectedPet) {
ย ย ย ย <div class="content-layout">
ย ย ย ย ย 
ย ย ย ย ย <div class="left-panel">
ย ย ย ย ย ย ย <div class="summary-card">
ย ย ย ย ย ย ย ย ย <!-- FIX: Removed ?. -->
ย ย ย ย ย ย ย ย ย <h2>{{ selectedPet.name }}'s Health Summary</h2>
ย ย ย ย ย ย ย ย ย <div class="summary-grid">
ย ย ย ย ย ย ย ย ย ย ย <div class="summary-item status-overdue">
ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>{{ overdueCount }}</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย <span>Overdue Doses</span>
ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย <div class="summary-item status-due">
ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>{{ dueSoonCount }}</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย <span>Due Soon (30 Days)</span>
ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย <div class="summary-item status-complete">
ย ย ย ย ย ย ย ย ย ย ย ย ย <strong>{{ vaccineRecords.length - overdueCount }}</strong>
ย ย ย ย ย ย ย ย ย ย ย ย ย <span>Total Doses Logged</span>
ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย <div class="recommendations-card">
ย ย ย ย ย ย ย ย ย <!-- FIX: Removed ?. -->
ย ย ย ย ย ย ย ย ย <h2>Recommended Vaccines for {{ selectedPet.type }}s</h2>
ย ย ย ย ย ย ย ย ย @for (reco of recommendations; track reco.name) {
ย ย ย ย ย ย ย ย ย ย <div class="reco-item">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="reco-header">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="reco-name">{{ reco.name }}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="reco-age">({{ reco.ageStart }})</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <p class="reco-frequency">{{ reco.frequency }}</p>
ย ย ย ย ย ย ย ย ย ย ย ย <p class="reco-details">๐ก Why: {{ reco.whyNeeded }}</p>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย </div>
ย ย ย ย ย </div>

ย ย ย ย ย <div class="right-panel">
ย ย ย ย ย ย ย <h2>Vaccine History Timeline</h2>
ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย <div class="timeline-container">
ย ย ย ย ย ย ย ย @for (record of vaccineRecords; track record.dateGiven) {
ย ย ย ย ย ย ย ย ย <div class="timeline-item">
ย ย ย ย ย ย ย ย ย ย ย <div class="timeline-dot" 
ย ย ย ย ย ย ย ย ย ย ย ย ย [class.overdue]="isOverdue(record.nextDueDate)" 
ย ย ย ย ย ย ย ย ย ย ย ย ย [class.completed]="record.status === 'Completed'">
ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย <div class="timeline-content">
ย ย ย ย ย ย ย ย ย ย ย ย ย <h3>{{ record.vaccineName }}</h3>
ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="date-given">Given: {{ record.dateGiven | date:'mediumDate' }} by {{ record.vetName }}</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="date-due" [class.overdue-text]="isOverdue(record.nextDueDate)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย Next Due: {{ record.nextDueDate | date:'mediumDate' }}
ย ย ย ย ย ย ย ย ย ย ย ย ย </p>
ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="status-chip" [class.status-overdue]="isOverdue(record.nextDueDate)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {{ isOverdue(record.nextDueDate) ? 'โ OVERDUE' : 'โ COMPLETE' }}
ย ย ย ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย @if (vaccineRecords.length === 0) { 
ย ย ย ย ย ย ย ย ย <div class="empty-state-records">
ย ย ย ย ย ย ย ย ย ย ย <!-- FIX: Removed ?. -->
ย ย ย ย ย ย ย ย ย ย ย No history found for {{ selectedPet.name }}. Log the first dose!
ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย </div>
ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย ย }
ย ย ย 
ย ย ย @if (!selectedPet) {
ย ย ย ย <div class="empty-state-page">
ย ย ย ย ย ย <p>Please add or select a pet to manage vaccination records.</p>
ย ย ย ย ย ย <button class="add-pet-btn" (click)="navigateTo('profile')">Add New Pet</button>
ย ย ย ย </div>
ย ย ย }

ย ย </div>
ย </main>
ย 
ย @if (showAddModal) {
ย ย <div class="modal-overlay" (click)="closeAddRecordModal()">
ย ย ย ย <div class="modal-content" (click)="$event.stopPropagation()">
ย ย ย ย ย ย <div class="modal-header">
ย ย ย ย ย ย ย ย <h2>Log New Vaccine Dose</h2>
ย ย ย ย ย ย ย ย <button class="close-btn" (click)="closeAddRecordModal()">โ</button>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <form #vaccineForm="ngForm" (ngSubmit)="saveVaccineRecord(vaccineForm.valid!)">
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label>Pet</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" [value]="selectedPet?.name" disabled>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="vaccineName">Vaccine Name *</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="vaccineName" name="vaccineName" [(ngModel)]="newRecord.vaccineName" required>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย <div class="form-group-inline">
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="dateGiven">Date Given *</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="date" id="dateGiven" name="dateGiven" [(ngModel)]="newRecord.dateGiven" required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="nextDueDate">Next Due Date *</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input type="date" id="nextDueDate" name="nextDueDate" [(ngModel)]="newRecord.nextDueDate" required>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="form-group">
ย ย ย ย ย ย ย ย ย ย <label for="vetName">Veterinarian/Clinic Name</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="vetName" name="vetName" [(ngModel)]="newRecord.vetName">
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <button type="submit" class="submit-modal-btn" [disabled]="!vaccineForm.valid">
ย ย ย ย ย ย ย ย ย ย Save Vaccine Record
ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย </form>
ย ย ย ย </div>
ย ย </div>
ย }
</div>